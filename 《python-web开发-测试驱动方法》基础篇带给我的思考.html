<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content="Pyloons">
  <meta name="description" content="Posts and writings by Pyloons">
  <title>
    Pyloons'Notes
&ndash; 《Python Web开发 测试驱动方法》基础篇带给我的思考  </title>
  <link href='http://fonts.font.im/css?family=Open+Sans:300' rel='stylesheet' type='text/css'>
  <!-- link href="//fonts.googleapis.com/css?family=Open+Sans:600,800" rel="stylesheet" type="text/css"-->
  <link rel="shortcut icon" href="https://pyloons.github.io/theme/images/favicon.ico">
  <link href="https://www.pyloons.com/feed" type="application/atom+xml" rel="alternate" title="Pyloons'Notes Atom" />

  <link rel="stylesheet" href="https://pyloons.github.io/theme/webassets-external/6f0791f317318630eea287e1827dd95e_all.css">
  <link rel="stylesheet" href="https://pyloons.github.io/theme/webassets-external/1907e3235bdd5d326046b3675ebdeb02_github.css">
  <link rel="stylesheet" href="https://pyloons.github.io/theme/webassets-external/7e67aaf7b4651ca5d72e8f8378096e57_custom.css">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
  
<meta name="keywords" content="Django, TDD">
</head>
<body>
  <div class="container">
    <div class="four columns sidebar">
<nav>
  <!-- h1>Hi.</h1 -->
  <a href="https://www.pyloons.com/">
    <img src="https://pyloons.github.io/theme/images/loon.jpg" id="gravatar" alt="My photo"/>
  </a>
  <h2><a href="https://www.pyloons.com/">Pyloons</a></h2>

  <!--div id="bio">
    <p><b>我是一名编程爱好者，喜欢各种与Python相关的技术，目前主要学习Django开发。</b></p>
  </div-->

  <div id="social">
<div id="stalker">


  <a title="pyloons on Github" href="https://github.com/pyloons">
    <i class="fa fa-github"></i>
  </a>













<a title="Atom feed" href="https://www.pyloons.com/feed">
  <i class="fa fa-rss"></i>
</a>
</div>  </div>

  <div id="tags">
    <ul>
      <li><a href="https://www.pyloons.com/categories.html">分 类</a></li>
      <li><a href="https://www.pyloons.com/tags.html">标 签</a></li>
      <li><a href="https://www.pyloons.com/archives.html">归 档</a></li>
    </ul>
  </div>

  <div class="footer">
<div class="disclaimer">
  
    <p>© Pyloons, 2017 &mdash; built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="https://github.com/karambir/taman" target="_blank">Taman</a>, a port of jekyll theme <a href="https://github.com/swanson/lagom" target="_blank">Lagom</a>.
    </p>
  </div>  </div>
</nav>    </div>
    <div style="float:left;width:1px;height:480px;background:#ddd;margin-top:75px;"></div> 
    <div class="eleven columns content">
  <div class="meta">
    <span>05 十月 2017&nbsp;</span>
    <span class="meta article_meta related">
      <!--h3>Category: </h3-->
      <span><i class="fa fa-folder"></i>&nbsp;<a href="https://www.pyloons.com/category/python.html">Python&nbsp;</span></a>
      <!--h3>Tags:</h3-->
      <span>
        <i class="fa fa-bookmark"></i>&nbsp;
        <a href="https://www.pyloons.com/tag/django.html">Django</a>,        <a href="https://www.pyloons.com/tag/tdd.html">TDD</a>      </span>&nbsp;
    </span>
    <span>
      <a href="/"><i class="home fa fa-home"></i></a>
    </span>
  </div>

  

  <hr>
  <h1 class="title"><a href="https://www.pyloons.com/《python-web开发-测试驱动方法》基础篇带给我的思考.html">《Python Web开发 测试驱动方法》基础篇带给我的思考</a></h1>
  <div class="article_text" id="post">
    <p><img alt="goat" src="http://pyloons.pythonanywhere.com/media/images/goat-2632143_960_720.2e16d0ba.fill-800x450.jpg"></p>
<blockquote>
<p>代码构建过程太过于繁复，我来记录一下心得体会好了。</p>
</blockquote>
<p>​        从第一行代码开始，作者就开始了令我费解的繁复的测试，但我明白TDD确实是一种重要的开发技能，所以还是强忍着别扭敲了一遍书上的代码。</p>
<h3>TDD的最核心的流程</h3>
<p>​        在书上可以找到一个流程图，很好地说明了TDD究竟是一个什么样的开发流程。既然是测试推着开发走，那么开局最重要的自然是写测试。书中是从最简单的网页标题开始写的。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="code-line">1</span>
<span class="code-line">2</span>
<span class="code-line">3</span>
<span class="code-line">4</span>
<span class="code-line">5</span>
<span class="code-line">6</span>
<span class="code-line">7</span>
<span class="code-line">8</span>
<span class="code-line">9</pre></div></td><td class="code"><div class="highlight"><pre><span class="code-line"><span></span><span class="ch">#!python</span></span>
<span class="code-line"><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">browser</span> <span class="o">-</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Firefox</span><span class="p">()</span></span>
<span class="code-line"><span class="c1"># 原书在这里挖了一个坑，火狐浏览器需要geckodriver才能启动</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">browser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://localhost:8000&#39;</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="k">assert</span> <span class="s1">&#39;Django&#39;</span> <span class="ow">in</span> <span class="n">browser</span><span class="o">.</span><span class="n">title</span></span>
</pre></div>
</td></tr></table>

<p>​        以及后文中类似的测试数不胜数。靠着这个，一步一步稳稳地开发出了清单应用的最小可用版本。</p>
<p>​        写好了测试，自然就要运行它，一般情况下初次运行测试，得到的只有错误；请适应错误带来的打击，然后去解决这个错误。比如上面一段测试代码，如果写成一个Python脚本去运行，必然带来错误——毕竟连Django都没有安装，开发服务器也没有运行，怎么也不可能是对的。但是正如书本标题所说，测试驱动开发；现在测试出了问题，你必须用开发来解决这个问题，让测试不再出问题。</p>
<p>​        这里必须说明的是，不是说测试出了问题，你就要大篇幅地写代码，完成这个功能——恰恰相反，你必须只写最小的代码，目的仅仅是让测试通过。你得忘记自己曾经是个什么样的开发者才行。于是在后文就有了类似于以下这样的代码：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="code-line">1</span>
<span class="code-line">2</span>
<span class="code-line">3</span>
<span class="code-line">4</pre></div></td><td class="code"><div class="highlight"><pre><span class="code-line"><span></span><span class="ch">#!python</span></span>
<span class="code-line"><span class="c1"># lists/views.py</span></span>
<span class="code-line"><span class="k">def</span> <span class="nf">home_page</span><span class="p">(</span><span class="n">request</span><span class="p">):</span></span>
<span class="code-line">    <span class="k">pass</span></span>
</pre></div>
</td></tr></table>

<p>​        什么都不做，就问你怕不怕！</p>
<p>​        当然并不是真的什么都不做，尽管这种无意义的代码确实能通过之前那个测试报错，但是它必然会带来其他的问题，或者在另一个测试中引起问题——解决它是迟早要做的事，不要因为这个小瑕疵破坏了TDD帅气的姿势。</p>
<p>​        再然后，如果测试全都通过了呢？单元测试无误，你还可以看看代码是不是可以优化呀？代码优化之后，是不是又报错了咯？如果不再报错，那功能测试是不是没问题咯？如果功能测试也没问题了，你是不是还要开发新功能或者强化现有功能咯？</p>
<p>​        所以，测试推动开发进程，是一个无穷无尽的循环；如果把用户需求转化为功能测试，这个过程。它的技术并不复杂，挑战的是耐心和恒心。</p>
<h3>现在是名词解释时间</h3>
<ol>
<li><strong>用户故事 </strong> 从用户的角度描述应用如何运行，来组织功能测试。</li>
<li><strong>功能测试  </strong>从应用外部观察应用的运行，有很多名字，国内更喜欢用黑箱测试这个说法。</li>
<li><strong>预期失败</strong>  意料之中的失败。</li>
<li><strong>意外失败  </strong>测试在意料之外失败，通常认为是测试中有错误或者出现了一个回归引起的。</li>
<li><strong>回归  </strong>新添加的代码破坏了原本正常的功能；一般这种情况需要重构旧的代码。</li>
</ol>
<h3>其他收获</h3>
<ol>
<li>反复向本地git仓库提交代码，现在感觉git熟练度上升不少。</li>
<li>为视图编写单元测试的基本三步：创建需要的对象实例、把这个实例提交给处理它的视图函数（或视图类）、使用断言测试处理结果。</li>
<li>三角法——如果通过作弊手段就能通过测试，那就再写一个符合需求但不符合作弊手段的测试，让测试失败，强迫自己些更好的代码。</li>
<li>事不过三，三则重构——如果一段代码让自己反复粘贴达三次，那么它需要重构，成为一个独立的模块</li>
<li>待办事项清单可以很好的记录你的灵感和客户的需求，尽量都写在清单上比较好。</li>
<li>测试隔离会更酷。</li>
<li>不要编写多余的代码，尽管你觉得这些代码可能有用，但是不要写，因为YAGNI——You ain't gonna need it。</li>
</ol>
<h3>结尾说明</h3>
<p>​        并不觉得自己学懂了多少，毕竟思路与自己的习惯差距太大。不过TDD方法确实有它的独到之处，这本书还是要多看几遍才能掌握。</p>
  </div>
  

    </div>
  </div>

</body>
</html>